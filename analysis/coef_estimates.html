<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>coef_estimates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="coef_estimates_files/libs/clipboard/clipboard.min.js"></script>
<script src="coef_estimates_files/libs/quarto-html/quarto.js"></script>
<script src="coef_estimates_files/libs/quarto-html/popper.min.js"></script>
<script src="coef_estimates_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="coef_estimates_files/libs/quarto-html/anchor.min.js"></script>
<link href="coef_estimates_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="coef_estimates_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="coef_estimates_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="coef_estimates_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="coef_estimates_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<p>Most of the code here is borrowed from https://github.com/mikabr/aoa-prediction</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4          ✔ readr     2.1.5     
✔ forcats   1.0.0          ✔ stringr   1.5.1     
✔ ggplot2   3.5.1.9000     ✔ tibble    3.2.1     
✔ lubridate 1.9.4          ✔ tidyr     1.3.1     
✔ purrr     1.0.4          
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/visuallearninglab/Documents/babyview-object</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'cowplot'

The following object is masked from 'package:lubridate':

    stamp</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggthemes'

The following object is masked from 'package:cowplot':

    theme_map</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lme4
Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack


Attaching package: 'lmerTest'

The following object is masked from 'package:lme4':

    lmer

The following object is masked from 'package:stats':

    step</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mirt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4
Loading required package: lattice

Attaching package: 'mirt'

The following object is masked from 'package:lme4':

    fixef</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("langcog/wordbankr")</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordbankr)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'MuMIn':
  method        from 
  nobs.multinom broom</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"helpers.R"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>base_size_print<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>label_size<span class="ot">=</span><span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="import-object-detection-data" class="level1">
<h1>1. Import object detection data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>object_counts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data/overall_category_distribution.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 304 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): class_name
dbl (8): n_frame_video_subject_age_detections, n_unique_videos, total_frame_...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>aoa_values <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data/coef_data/eng_aoas.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">item_definition =</span> <span class="fu">case_when</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>      item_definition <span class="sc">==</span> <span class="st">"TV"</span> <span class="sc">~</span> <span class="st">"tv"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>      item_definition <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"couch"</span>) <span class="sc">~</span> <span class="st">"couch, sofa"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      item_definition <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"trash"</span>) <span class="sc">~</span> <span class="st">"garbage, trash"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      item_definition <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"backyard"</span>) <span class="sc">~</span> <span class="st">"backyard, yard"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      item_definition <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"noodles"</span>) <span class="sc">~</span> <span class="st">"noodles, spaghetti"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> item_definition</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="st">"item_definition"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measure,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> aoa,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"aoa_"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1077 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): item_definition, measure
dbl (3): intercept, slope, aoa

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>object_counts_cleaned <span class="ot">&lt;-</span> object_counts <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(class_name, <span class="at">.keep_all=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filtering out more spurious classes</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(class_name <span class="sc">!=</span> <span class="st">"person"</span> <span class="sc">&amp;</span> class_name <span class="sc">!=</span> <span class="st">"picture"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_cleaned =</span> <span class="fu">round</span>(<span class="dv">10000</span><span class="sc">*</span> proportion,<span class="dv">5</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">percentage =</span> <span class="dv">100</span><span class="sc">*</span>proportion,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_proportion =</span> <span class="fu">log</span>(percentage),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">visual_frequency =</span> <span class="fu">scale</span>(log_proportion)) <span class="sc">|&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">object=</span>class_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-existing-word-trajectory-predictors" class="level1">
<h1>2. Load existing word trajectory predictors</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loaded from https://github.com/mikabr/aoa-prediction</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>original_uni_joined <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="fu">here</span>(<span class="st">"data/coef_data/original_uni_joined.RData"</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>original_uni_joined <span class="ot">&lt;-</span> <span class="fu">get</span>(original_uni_joined)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">here</span>(<span class="st">"data/coef_data/uni_joined.Rdata"</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>eng_joined <span class="ot">&lt;-</span> uni_joined <span class="sc">|&gt;</span> <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"English (American)"</span>) <span class="sc">|&gt;</span> <span class="fu">left_join</span>(aoa_values, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"words"</span><span class="ot">=</span><span class="st">"item_definition"</span>))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>original_eng_joined <span class="ot">&lt;-</span> original_uni_joined <span class="sc">|&gt;</span> <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"English (American)"</span>) <span class="sc">|&gt;</span> <span class="fu">left_join</span>(aoa_values, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"words"</span><span class="ot">=</span><span class="st">"item_definition"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Checking if the proportions from the new preprocessing code I incorporated correlates with the old ones pulled directly from Mika’s code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>added_coefs <span class="ot">&lt;-</span> eng_joined <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(original_eng_joined <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">original_prop =</span> prop, <span class="at">original_frequency =</span> frequency) <span class="sc">|&gt;</span> <span class="fu">select</span>(original_prop, uni_lemma, measure, original_frequency, age)) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(original_prop) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(prop) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(original_prop) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(original_frequency))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(measure, uni_lemma, age)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(added_coefs <span class="sc">|&gt;</span> <span class="fu">select</span>(prop, original_prop, frequency, original_frequency))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         prop original_prop  frequency original_frequency
prop               1.00000000    0.96592140 0.07433446         0.07476677
original_prop      0.96592140    1.00000000 0.06895806         0.06986208
frequency          0.07433446    0.06895806 1.00000000         0.99808364
original_frequency 0.07476677    0.06986208 0.99808364         1.00000000</code></pre>
</div>
</div>
<p>Phew.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># based on this model just going to join on any row that contains the object even if that means matching with multiple words, since that's what it looks like is being done with MLU etc.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>longer_cdi_objects <span class="ot">&lt;-</span> object_counts_cleaned <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(object, visual_frequency, log_proportion, AoA) <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">matching =</span> <span class="fu">list</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    eng_joined <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">str_starts</span>(uni_lemma, <span class="fu">fixed</span>(<span class="fu">paste0</span>(object, <span class="st">" "</span>)))) <span class="sc">|&gt;</span> <span class="fu">filter</span>(lexical_classes <span class="sc">==</span> <span class="st">"nouns"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(matching) <span class="sc">|&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">original_object=</span>object) <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(uni_lemma <span class="sc">!=</span> <span class="st">"ice cream"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">object=</span>uni_lemma) <span class="sc">|&gt;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(language))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>shorter_cdi_objects <span class="ot">&lt;-</span> object_counts_cleaned <span class="sc">|&gt;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(object, visual_frequency, log_proportion, AoA)  <span class="sc">|&gt;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">original_object=</span>object) <span class="sc">|&gt;</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(eng_joined, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"object"</span><span class="ot">=</span><span class="st">"uni_lemma"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># getting rid of words that do not have a match</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(language))</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>eng_vars <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(longer_cdi_objects, shorter_cdi_objects) <span class="sc">|&gt;</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># re-calculating visual frequency after getting rid of all of the CDI words that don't exist in the model</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">visual_frequency =</span> <span class="fu">scale</span>(log_proportion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now looking at whether we missed any objects that were detected:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(object_counts_cleaned <span class="sc">|&gt;</span> <span class="fu">distinct</span>(object), eng_vars <span class="sc">|&gt;</span> <span class="fu">distinct</span>(original_object), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"object"</span><span class="ot">=</span><span class="st">"original_object"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  object
  &lt;chr&gt; 
1 penis 
2 butt  
3 vagina</code></pre>
</div>
</div>
<p>Right.</p>
<p>Looking at whether any of our words don’t have AoAs and adding in AoAs to the object counts</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>eng_vars <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(aoa_produces) <span class="sc">&amp;</span> <span class="fu">is.na</span>(aoa_understands)) <span class="sc">|&gt;</span> <span class="fu">distinct</span>(words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 1
# ℹ 1 variable: words &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>object_counts_cleaned <span class="ot">&lt;-</span> object_counts_cleaned <span class="sc">|&gt;</span> <span class="fu">left_join</span>(eng_vars <span class="sc">|&gt;</span> <span class="fu">distinct</span>(original_object, aoa_produces, aoa_understands),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"object"</span><span class="ot">=</span><span class="st">"original_object"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sanity checks:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(eng_vars <span class="sc">|&gt;</span> <span class="fu">distinct</span>(object))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 288</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(eng_vars <span class="sc">|&gt;</span> <span class="fu">distinct</span>(original_object))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 285</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(eng_joined <span class="sc">|&gt;</span> <span class="fu">distinct</span>(uni_lemma))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 661</code></pre>
</div>
</div>
</section>
<section id="straightforward-aoa-predictorplot" class="level1">
<h1>3. Straightforward AoA predictor/plot</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>object_counts_long <span class="ot">&lt;-</span> object_counts_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(aoa_produces, aoa_understands),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"aoa_type"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"aoa_value"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">aoa_type =</span> <span class="fu">recode</span>(aoa_type,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"aoa_produces"</span> <span class="ot">=</span> <span class="st">"AoA Production"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"aoa_understands"</span> <span class="ot">=</span> <span class="st">"AoA Comprehension"</span>))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the faceted plot</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>aoa_objects_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(object_counts_long, <span class="fu">aes</span>(<span class="at">x =</span> aoa_value, <span class="at">y =</span> log_proportion)) <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> aoa_type, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>   ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> object_counts_long <span class="sc">|&gt;</span> <span class="fu">filter</span>(object <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"book"</span>, <span class="st">"dog"</span>, <span class="st">"milk"</span>, <span class="st">"penny"</span>, <span class="st">"chair"</span>, <span class="st">"table"</span>)),</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> object)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">8</span>) <span class="sc">+</span>  </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">vjust =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Log (percentage of frames with object detected)"</span>) <span class="sc">+</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age of Acquisition"</span>) <span class="sc">+</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"data/figures/aoa_plot_full.png"</span>), aoa_objects_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 107 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 107 rows containing non-finite outside the scale range
(`stat_cor()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 107 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
</div>
<section id="a.-plot-for-ccn" class="level2">
<h2 class="anchored" data-anchor-id="a.-plot-for-ccn">3a. Plot for CCN</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cdi_metadata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data/cdi_words.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 301 Columns: 17
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (12): item_id, language, form, item_kind, category, item_definition, eng...
dbl  (4): is_animated, is_small_obj, is_big_obj, AoA
lgl  (1): complexity_category

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>object_counts_plot <span class="ot">&lt;-</span> object_counts_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    cdi_metadata <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(uni_lemma) <span class="sc">|&gt;</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice_min</span>(<span class="at">order_by =</span> AoA, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(uni_lemma, category),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"object"</span> <span class="ot">=</span> <span class="st">"uni_lemma"</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(category=ifelse(category == "furniture_rooms", ifelse(object %in% c("basement", "bathroom", "bedroom", "kitchen",</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                           "garage", "room"), "room", "furniture"), category)) |&gt;</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">case_when</span>(</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>      category <span class="sc">==</span> <span class="st">"food_drink"</span> <span class="sc">~</span> <span class="st">"food"</span>,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>      category <span class="sc">==</span> <span class="st">"body_parts"</span> <span class="sc">~</span> <span class="st">"body parts"</span>,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>      category <span class="sc">==</span> <span class="st">"furniture_rooms"</span> <span class="sc">~</span> <span class="st">"household"</span>,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> category)) <span class="sc">|&gt;</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">str_to_sentence</span>(category)) <span class="sc">|&gt;</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(object) <span class="sc">|&gt;</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">reframe</span>(</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">aoa_produces   =</span> <span class="fu">mean_na_or_na</span>(aoa_produces),</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">aoa_understands =</span> <span class="fu">mean_na_or_na</span>(aoa_understands),</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">first</span>(.x))  </span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>category_averages <span class="ot">&lt;-</span> object_counts_plot <span class="sc">|&gt;</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">|&gt;</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_log_proportion =</span> <span class="fu">mean</span>(log_proportion, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(avg_log_proportion)</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert category to factor with ordered levels based on average log_proportion</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>object_counts_plot <span class="ot">&lt;-</span> object_counts_plot <span class="sc">|&gt;</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(category, <span class="at">levels =</span> category_averages<span class="sc">$</span>category))</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>aoa_objects_plot_production <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(object_counts_plot, <span class="fu">aes</span>(<span class="at">x=</span> aoa_produces, <span class="at">y=</span>log_proportion)) <span class="sc">+</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">4</span>, <span class="at">alpha=</span><span class="fl">0.4</span>, <span class="fu">aes</span>(<span class="at">color=</span>category)) <span class="sc">+</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color=</span><span class="st">"#555"</span>) <span class="sc">+</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">size=</span>label_size,</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> object_counts_cleaned <span class="sc">|&gt;</span> <span class="fu">filter</span>(object <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"book"</span>, <span class="st">"dog"</span>, <span class="st">"milk"</span>, <span class="st">"penny"</span>, <span class="st">"chair"</span>, <span class="st">"table"</span>, <span class="st">"porch"</span>, <span class="st">"plant"</span>, <span class="st">"hat"</span>, <span class="st">"crayon"</span>, <span class="st">"diaper"</span>, <span class="st">"bathroom"</span>, <span class="st">"tv"</span>, <span class="st">"toy"</span>, <span class="st">"truck"</span>, <span class="st">"hand"</span>, <span class="st">"ball"</span>, <span class="st">"face"</span>, <span class="st">"nose"</span>, <span class="st">"penguin"</span>, <span class="st">"juice"</span>, <span class="st">"cheese"</span>, <span class="st">"crib"</span>, <span class="st">"blanket"</span>, <span class="st">"bucket"</span>, <span class="st">"plate"</span>, <span class="st">"tray"</span>, <span class="st">"knee"</span>, <span class="st">"owie"</span>, <span class="st">"raisin"</span>, <span class="st">"puzzle"</span>, <span class="st">"drink"</span>, <span class="st">"zipper"</span>, <span class="st">"pasta"</span>, <span class="st">"turtle"</span>)), <span class="at">alpha=</span><span class="fl">0.8</span>,<span class="at">force=</span><span class="dv">10</span>,<span class="at">force_pull=</span><span class="fl">0.1</span>,<span class="at">nudge_y=</span><span class="sc">-</span><span class="fl">0.1</span>,<span class="at">max.overlaps =</span> <span class="dv">15</span>,</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> object)</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">6</span>) <span class="sc">+</span>  </span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"log (percentage of frames with object)"</span>) <span class="sc">+</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Estimated age-of-acquisition of word (in months)"</span>) <span class="sc">+</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme</span>(</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),              <span class="co"># All text bold</span></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase space between x-axis and its title</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>      <span class="co">#face = "bold", </span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">0</span>),</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.1</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase space between y-axis and its title</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>      <span class="co">#face = "bold", </span></span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">size=</span> <span class="dv">20</span>,</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">0</span>)</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),  <span class="co"># Small bold legend title</span></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>)    <span class="co"># Small bold legend text</span></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">option=</span><span class="st">"D"</span>,</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>                        <span class="at">discrete=</span><span class="cn">TRUE</span>,</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>                     <span class="at">end =</span> <span class="fl">0.9</span>,       <span class="co"># Avoids the light yellow at the end</span></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name=</span><span class="st">"Object category"</span>) <span class="sc">+</span></span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">14</span>, <span class="dv">34</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">14</span>,<span class="dv">34</span>))</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>aoa_objects_plot_production</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 2 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"data/figures/aoa_plot_afd.svg"</span>),<span class="at">device=</span><span class="st">"pdf"</span>, aoa_objects_plot_production, <span class="at">width=</span><span class="fl">7.5</span>,<span class="at">height=</span><span class="dv">9</span>,<span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"data/figures/aoa_plot.svg"</span>),aoa_objects_plot_production, <span class="at">width=</span><span class="fl">7.5</span>,<span class="at">height=</span><span class="dv">9</span>,<span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite outside the scale range (`stat_smooth()`).
Removed 3 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
</div>
</section>
<section id="b.-linear-modeling" class="level2">
<h2 class="anchored" data-anchor-id="b.-linear-modeling">3b. Linear modeling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>simple_effect <span class="ot">&lt;-</span> <span class="fu">lm</span>(aoa_produces <span class="sc">~</span> visual_frequency, <span class="at">data=</span>object_counts_plot)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = aoa_produces ~ visual_frequency, data = object_counts_plot)

Residuals:
   Min     1Q Median     3Q    Max 
-9.555 -2.087  0.066  2.005  8.946 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       24.2861     0.1924 126.199   &lt;2e-16 ***
visual_frequency  -0.4274     0.1937  -2.207   0.0281 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.249 on 283 degrees of freedom
  (3 observations deleted due to missingness)
Multiple R-squared:  0.01692,   Adjusted R-squared:  0.01345 
F-statistic: 4.871 on 1 and 283 DF,  p-value: 0.02812</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>all_effects <span class="ot">&lt;-</span> <span class="fu">lm</span>(aoa_produces <span class="sc">~</span> visual_frequency <span class="sc">+</span> <span class="fu">scale</span>(MLU) <span class="sc">+</span> <span class="fu">scale</span>(frequency) <span class="sc">+</span> <span class="fu">scale</span>(babiness) <span class="sc">+</span> <span class="fu">scale</span>(concreteness) <span class="sc">+</span> <span class="fu">scale</span>(final_frequency) <span class="sc">+</span> <span class="fu">scale</span>(solo_freq) <span class="sc">+</span> <span class="fu">scale</span>(valence) <span class="sc">+</span> <span class="fu">scale</span>(arousal), <span class="at">data=</span>eng_vars <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(aoa_understands)) <span class="sc">|&gt;</span> <span class="fu">distinct</span>(object, <span class="at">.keep_all=</span><span class="cn">TRUE</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(all_effects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = aoa_produces ~ visual_frequency + scale(MLU) + scale(frequency) + 
    scale(babiness) + scale(concreteness) + scale(final_frequency) + 
    scale(solo_freq) + scale(valence) + scale(arousal), data = distinct(filter(eng_vars, 
    !is.na(aoa_understands)), object, .keep_all = TRUE))

Residuals:
    Min      1Q  Median      3Q     Max 
-5.0240 -1.1831  0.0666  1.1713  5.6231 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            22.71847    0.14196 160.039  &lt; 2e-16 ***
visual_frequency       -0.07069    0.16063  -0.440    0.660    
scale(MLU)             -0.11811    0.21212  -0.557    0.578    
scale(frequency)       -0.48985    0.38788  -1.263    0.209    
scale(babiness)        -0.77096    0.15357  -5.020 1.40e-06 ***
scale(concreteness)    -0.18566    0.15252  -1.217    0.225    
scale(final_frequency) -0.26971    0.26580  -1.015    0.312    
scale(solo_freq)       -1.55813    0.32214  -4.837 3.16e-06 ***
scale(valence)          0.15884    0.14832   1.071    0.286    
scale(arousal)          0.02602    0.15354   0.169    0.866    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.809 on 155 degrees of freedom
  (22 observations deleted due to missingness)
Multiple R-squared:  0.6166,    Adjusted R-squared:  0.5944 
F-statistic:  27.7 on 9 and 155 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(all_effects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           R2m       R2c
[1,] 0.6032107 0.6032107</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(all_effects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      visual_frequency             scale(MLU)       scale(frequency) 
              1.325997               2.327931               7.601051 
       scale(babiness)    scale(concreteness) scale(final_frequency) 
              1.150909               1.175413               3.660791 
      scale(solo_freq)         scale(valence)         scale(arousal) 
              4.858893               1.152224               1.181066 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(all_effects)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The main models we’re using for CCN:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>smaller_model_understands <span class="ot">&lt;-</span> <span class="fu">lm</span>(aoa_understands <span class="sc">~</span> visual_frequency <span class="sc">+</span> <span class="fu">scale</span>(frequency) <span class="sc">+</span> <span class="fu">scale</span>(concreteness), <span class="at">data=</span>eng_vars <span class="sc">|&gt;</span> <span class="fu">distinct</span>(object, <span class="at">.keep_all=</span><span class="cn">TRUE</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smaller_model_understands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = aoa_understands ~ visual_frequency + scale(frequency) + 
    scale(concreteness), data = distinct(eng_vars, object, .keep_all = TRUE))

Residuals:
    Min      1Q  Median      3Q     Max 
-6.8108 -1.5604  0.0679  1.7191  5.1765 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         17.03806    0.19553  87.136  &lt; 2e-16 ***
visual_frequency    -0.53941    0.18622  -2.897  0.00424 ** 
scale(frequency)    -1.65163    0.21772  -7.586 1.67e-12 ***
scale(concreteness) -0.04683    0.21926  -0.214  0.83111    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.468 on 181 degrees of freedom
  (103 observations deleted due to missingness)
Multiple R-squared:  0.2881,    Adjusted R-squared:  0.2763 
F-statistic: 24.42 on 3 and 181 DF,  p-value: 2.577e-13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>smaller_model_produces <span class="ot">&lt;-</span> <span class="fu">lm</span>(aoa_produces <span class="sc">~</span> visual_frequency <span class="sc">+</span> <span class="fu">scale</span>(frequency) <span class="sc">+</span> <span class="fu">scale</span>(concreteness), <span class="at">data=</span>eng_vars  <span class="sc">|&gt;</span> <span class="fu">distinct</span>(object, <span class="at">.keep_all=</span><span class="cn">TRUE</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smaller_model_produces)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = aoa_produces ~ visual_frequency + scale(frequency) + 
    scale(concreteness), data = distinct(eng_vars, object, .keep_all = TRUE))

Residuals:
   Min     1Q Median     3Q    Max 
-7.139 -1.288 -0.185  1.546 11.215 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         24.24526    0.13862 174.900  &lt; 2e-16 ***
visual_frequency     0.01294    0.14055   0.092  0.92668    
scale(frequency)    -2.28974    0.14155 -16.177  &lt; 2e-16 ***
scale(concreteness) -0.37170    0.13882  -2.678  0.00785 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.339 on 281 degrees of freedom
  (3 observations deleted due to missingness)
Multiple R-squared:  0.4948,    Adjusted R-squared:  0.4894 
F-statistic: 91.75 on 3 and 281 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Which words might be causing this disconnect</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(eng_vars <span class="sc">|&gt;</span> <span class="fu">distinct</span>(object), eng_vars <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(aoa_understands)) <span class="sc">|&gt;</span> <span class="fu">distinct</span>(object))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 101 × 1
   object       
   &lt;chr&gt;        
 1 can (object) 
 2 tape (object)
 3 nail (object)
 4 glue (object)
 5 bat (object) 
 6 mop (object) 
 7 crayon       
 8 bucket       
 9 napkin       
10 basket       
# ℹ 91 more rows</code></pre>
</div>
</div>
</section>
<section id="c.-just-looking-at-correlations" class="level2">
<h2 class="anchored" data-anchor-id="c.-just-looking-at-correlations">3c. just looking at correlations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>eng_vars_filtered <span class="ot">&lt;-</span> eng_vars <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(frequency) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(visual_frequency) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(concreteness))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using one column matrices in `filter()` was deprecated in dplyr 1.1.0.
ℹ Please use one dimensional logical vectors instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(eng_vars_filtered <span class="sc">|&gt;</span> <span class="fu">distinct</span>(visual_frequency, frequency, final_frequency, concreteness, object) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>object), <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 visual_frequency   frequency final_frequency concreteness
visual_frequency       1.00000000  0.18575190       0.2703418   0.04820423
frequency              0.18575190  1.00000000       0.6907779  -0.03236825
final_frequency        0.27034184  0.69077787       1.0000000   0.11109767
concreteness           0.04820423 -0.03236825       0.1110977   1.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>cor_test_eng_vars <span class="ot">&lt;-</span> eng_vars_filtered <span class="sc">|&gt;</span> <span class="fu">distinct</span>(visual_frequency, frequency, final_frequency, concreteness, object)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(cor_test_eng_vars<span class="sc">$</span>visual_frequency, cor_test_eng_vars<span class="sc">$</span>frequency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  cor_test_eng_vars$visual_frequency and cor_test_eng_vars$frequency
t = 3.1802, df = 283, p-value = 0.001635
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.07109931 0.29556019
sample estimates:
      cor 
0.1857519 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(cor_test_eng_vars<span class="sc">$</span>visual_frequency, cor_test_eng_vars<span class="sc">$</span>concreteness)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  cor_test_eng_vars$visual_frequency and cor_test_eng_vars$concreteness
t = 0.81186, df = 283, p-value = 0.4176
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.06836573  0.16347571
sample estimates:
       cor 
0.04820423 </code></pre>
</div>
</div>
<p>Formats seen, frequency, total count and babiness all show separate positive predictivity which is encouraging.</p>
</section>
</section>
<section id="implementing-mikas-code" class="level1">
<h1>4. Implementing Mika’s code</h1>
<p>Pulled code below from https://github.com/mikabr/aoa-prediction – joined AoA data and predictor data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"frequency"</span>, <span class="st">"MLU"</span>, <span class="st">"final_frequency"</span>, <span class="st">"solo_frequency"</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"num_phons"</span>, <span class="st">"concreteness"</span>, <span class="st">"valence"</span>, <span class="st">"arousal"</span>, <span class="st">"babiness"</span>, <span class="st">"visual_frequency"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>.alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a.-impute-and-scale-data-for-input-into-models." class="level2">
<h2 class="anchored" data-anchor-id="a.-impute-and-scale-data-for-input-into-models.">4a. Impute and scale data for input into models.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> eng_vars <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(object, <span class="fu">all_of</span>(predictors)) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>pred_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"frequency"</span>, <span class="st">"MLU"</span>, <span class="st">"final_frequency"</span>, <span class="st">"solo_frequency"</span>),</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"valence"</span>, <span class="st">"arousal"</span>),</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"visual_frequency"</span>),</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"concreteness"</span>, <span class="st">"babiness"</span>, <span class="st">"num_phons"</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>fit_predictor <span class="ot">&lt;-</span> <span class="cf">function</span>(pred, d) {</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="sc">!</span><span class="st">"object"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(d)) <span class="fu">stop</span>(<span class="st">"Missing 'object' column in data"</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> predictors[predictors <span class="sc">!=</span> pred]</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(xs) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="fu">glue</span>(<span class="st">"No valid predictors for {pred}"</span>))</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">length</span>(xs))</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  x_str <span class="ot">&lt;-</span> xs <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  formula_str <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{pred} ~ {x_str}"</span>)</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"Fitting model: {formula_str}"</span>))  <span class="co"># Debugging</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"{pred} ~ {x_str}"</span>)), <span class="at">data =</span> d) <span class="sc">%&gt;%</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata =</span> d) <span class="sc">%&gt;%</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(object, .fitted)</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>max_steps <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>iterate_predictors <span class="ot">&lt;-</span> <span class="cf">function</span>(lang_data) {</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  missing <span class="ot">&lt;-</span> lang_data <span class="sc">%&gt;%</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to=</span><span class="st">"predictor"</span>, <span class="at">values_to=</span><span class="st">"value"</span>, <span class="fu">all_of</span>(predictors)) <span class="sc">%&gt;%</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">missing =</span> <span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>value) <span class="sc">%&gt;%</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>predictor, <span class="at">values_from=</span>missing)</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>  predictor_order <span class="ot">&lt;-</span> lang_data <span class="sc">%&gt;%</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(predictor, value, <span class="fu">all_of</span>(predictors)) <span class="sc">%&gt;%</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(predictor) <span class="sc">%&gt;%</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">num_na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(value))) <span class="sc">%&gt;%</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(num_na <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(num_na) <span class="sc">%&gt;%</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(predictor)</span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>  imputation_data <span class="ot">&lt;-</span> lang_data <span class="sc">%&gt;%</span></span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(predictors), <span class="sc">~</span> <span class="fu">as.numeric</span>(Hmisc<span class="sc">::</span><span class="fu">impute</span>(., <span class="at">fun =</span> <span class="st">"random"</span>))))</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_steps) {</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> predictor_order[(i <span class="sc">%%</span> <span class="fu">length</span>(predictor_order)) <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>    imputation_fits <span class="ot">&lt;-</span> <span class="fu">fit_predictor</span>(pred, imputation_data)</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>    imputation_data <span class="ot">&lt;-</span> missing <span class="sc">%&gt;%</span></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(object, <span class="sc">!!</span>pred) <span class="sc">%&gt;%</span></span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">missing =</span> <span class="sc">!!</span>pred) <span class="sc">%&gt;%</span></span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">right_join</span>(imputation_data) <span class="sc">%&gt;%</span></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(imputation_fits) <span class="sc">%&gt;%</span></span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(pred, <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.), .fitted, .))) <span class="sc">%&gt;%</span></span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>.fitted, <span class="sc">-</span>missing)</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(imputation_data)</span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>model_data_imputed <span class="ot">&lt;-</span> <span class="fu">iterate_predictors</span>(model_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attributes are not identical across measure variables; they will be
dropped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: MLU ~ frequency + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `across(pred, ~if_else(is.na(.), .fitted, .))`.
Caused by warning:
! Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(pred)

  # Now:
  data %&gt;% select(all_of(pred))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: final_frequency ~ frequency + MLU + solo_frequency + num_phons + concreteness + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: frequency ~ MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: solo_frequency ~ frequency + MLU + final_frequency + num_phons + concreteness + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: concreteness ~ frequency + MLU + final_frequency + solo_frequency + num_phons + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: arousal ~ frequency + MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: valence ~ frequency + MLU + final_frequency + solo_frequency + num_phons + concreteness + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: babiness ~ frequency + MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: MLU ~ frequency + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: final_frequency ~ frequency + MLU + solo_frequency + num_phons + concreteness + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9
Fitting model: frequency ~ MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + babiness + visual_frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>uni_model_data <span class="ot">&lt;-</span> model_data_imputed <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(predictors), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(.)))) <span class="sc">%&gt;%</span>  </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    eng_vars <span class="sc">%&gt;%</span> </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"measure"</span>, <span class="st">"object"</span>, <span class="st">"age"</span>, <span class="st">"num_true"</span>, <span class="st">"num_false"</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>                      )))</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(measure) <span class="sc">%&gt;%</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">unscaled_age =</span> age, <span class="at">age =</span> <span class="fu">scale</span>(age),</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">as.double</span>(num_true <span class="sc">+</span> num_false), </span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> num_true <span class="sc">/</span> total</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`</code></pre>
</div>
</div>
</section>
<section id="b.-fitting-models" class="level2">
<h2 class="anchored" data-anchor-id="b.-fitting-models">4b. Fitting models</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>create_formula <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">response =</span> <span class="st">"prop"</span>, <span class="at">interaction_prefix =</span> <span class="st">"age"</span>, predictors_list, <span class="at">random_effect =</span> <span class="st">"(age | object)"</span>) {</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct interaction terms for each list of predictors</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  effects <span class="ot">&lt;-</span> <span class="fu">paste</span>(interaction_prefix, predictors_list, <span class="at">sep =</span> <span class="st">" * "</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine terms into a full formula string</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  formula_str <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{response} ~ {random_effect} + {paste(effects, collapse = ' + ')}"</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return as a formula object</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.formula</span>(formula_str))</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>fit_group_model <span class="ot">&lt;-</span> <span class="cf">function</span>(group_data, group_formula, <span class="at">contrasts =</span> <span class="cn">NULL</span>) {</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">&lt;-</span> <span class="fu">unique</span>(group_data<span class="sc">$</span>group)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Fitting model for {group}..."</span>))</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glmer</span>(<span class="at">formula =</span> group_formula,</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> group_data,</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">weights =</span> total,</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">contrasts =</span> contrasts)</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>by_measure_data <span class="ot">&lt;-</span> uni_model_data <span class="sc">%&gt;%</span></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">paste</span>(measure)) <span class="sc">%&gt;%</span></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(measure, group, object, prop,</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>         total, age, <span class="sc">!!</span>predictors) <span class="sc">%&gt;%</span></span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(measure) <span class="sc">%&gt;%</span></span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>effects_formula <span class="ot">&lt;-</span> <span class="fu">create_formula</span>(<span class="at">predictors_list =</span> predictors)</span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>  measure_models <span class="ot">&lt;-</span> by_measure_data <span class="sc">%&gt;%</span></span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> data <span class="sc">%&gt;%</span></span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>           <span class="fu">map</span>(<span class="sc">~</span><span class="fu">fit_group_model</span>(.x, effects_formula)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for produces...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for understands...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>  measure_fits <span class="ot">&lt;-</span> measure_models <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">results =</span> <span class="fu">map</span>(model, tidy))</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>measure_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"understands"</span>, <span class="st">"produces"</span>)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>measure_coefs <span class="ot">&lt;-</span> measure_fits <span class="sc">%&gt;%</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(measure, results) <span class="sc">%&gt;%</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">std_error =</span> std.error,</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>         <span class="co">#z_value = z.value,</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_value =</span> p.value) <span class="sc">%&gt;%</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"effect"</span>), <span class="at">sep =</span> <span class="st">" &amp; "</span>, <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>   <span class="at">effect =</span> <span class="fu">if_else</span>(<span class="fu">grepl</span>(<span class="st">":"</span>, term), <span class="st">"interaction with age"</span>, effect),</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(effect), <span class="st">"main effect"</span>, effect),</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> <span class="fu">if_else</span>(<span class="fu">grepl</span>(<span class="st">":"</span>, term),</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sub</span>(<span class="st">".*:"</span>, <span class="st">""</span>, term), term),</span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect =</span> <span class="fu">fct_relevel</span>(effect, <span class="st">"main effect"</span>, <span class="st">"interaction with age"</span>),</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">measure =</span> <span class="fu">factor</span>(measure, <span class="at">levels =</span> measure_levels),</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">signif =</span> p_value <span class="sc">&lt;</span> .alpha) <span class="sc">%&gt;%</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(measure, term, effect) <span class="sc">%&gt;%</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">:added in this line?</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(std_error)) <span class="sc">%&gt;%</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(results)`.</code></pre>
</div>
</div>
</section>
<section id="c.-plotting-model-effects" class="level2">
<h2 class="anchored" data-anchor-id="c.-plotting-model-effects">4c. Plotting model effects</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>predictor_effects <span class="ot">&lt;-</span> measure_coefs <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"main effect"</span>, term <span class="sc">%in%</span> predictors) <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">predictor_effect =</span> data) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `effect`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>mean_term_coefs <span class="ot">&lt;-</span> measure_coefs <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(data)) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"main effect"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_estimate =</span> <span class="fu">mean</span>(estimate),</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_sig =</span> <span class="fu">sum</span>(signif<span class="sc">==</span><span class="cn">TRUE</span>),</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_pos =</span> <span class="fu">sum</span>(estimate <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_neg =</span> <span class="fu">sum</span>(estimate <span class="sc">&lt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(mean_estimate)))</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>coef_order <span class="ot">&lt;-</span> mean_term_coefs <span class="sc">%&gt;%</span> <span class="fu">pull</span>(term)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>display_predictors <span class="ot">&lt;-</span> <span class="cf">function</span>(predictors) {</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>  predictors <span class="sc">%&gt;%</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"num"</span>, <span class="st">"number"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(<span class="st">"phons"</span>, <span class="st">"phonemes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_chr</span>(label_caps) <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(<span class="st">"MLU"</span>, <span class="st">"MLU-w"</span>)</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>label_caps <span class="ot">&lt;-</span> <span class="cf">function</span>(value) {</span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">if_else</span>(<span class="fu">toupper</span>(value) <span class="sc">==</span> value, value,</span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(<span class="fu">toupper</span>(<span class="fu">substr</span>(value, <span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">tolower</span>(<span class="fu">substr</span>(value, <span class="dv">2</span>, <span class="fu">nchar</span>(value))))) <span class="sc">%&gt;%</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"_"</span>, <span class="st">" "</span>)</span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a>plt_fixed_coefs <span class="ot">&lt;-</span> measure_coefs <span class="sc">%&gt;%</span></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> term <span class="sc">%&gt;%</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">rev</span>(coef_order)) <span class="sc">%&gt;%</span></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_relabel</span>(display_predictors),</span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">signif =</span> <span class="fu">ifelse</span>(signif, <span class="st">"significant"</span>, <span class="st">"non-significant"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_rev</span>(),</span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">measure =</span> <span class="fu">fct_recode</span>(measure, <span class="st">"comprehension"</span> <span class="ot">=</span> <span class="st">"understands"</span>,</span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"production"</span> <span class="ot">=</span> <span class="st">"produces"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(term <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"(intercept)"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(data)`.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plt_fixed_coefs, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> term)) <span class="sc">+</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(measure <span class="sc">~</span> effect, <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(label_caps)) <span class="sc">+</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">colour =</span> term, <span class="at">shape =</span> signif,</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmin =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std_error,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmax =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std_error)) <span class="sc">+</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">"Coefficient estimate"</span>, <span class="at">title=</span><span class="st">"Word developmental trajectory predictors"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in
ggplot2 3.3.4.
ℹ Please use "none" instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/refcoefs-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Estimates of coefficients in predicting words’ developmental trajectories for English comprehension and production data. Larger coefficient values indicate a greater effect of the predictor on acquisition: positive main effects indicate that words with higher values of the predictor tend to be understood/produced by more children, while negative main effects indicate that words with lower values of the predictor tend to be understood/produced by more children; positive age interactions indicate that the predictor’s effect increases with age, while negative age interactions indicate the predictor’s effect decreases with age. Line ranges indicates 95% confidence intervals; filled in points indicate coefficients for which <span class="math inline">\(p &lt; 0.05\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(plt_fixed_coefs, <span class="st">"fixed_coefs.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This isn’t exactly what I expected so I’m going to try out different models quickly by collapsing our code into helper funcs ## 4d. Testing out different models by collapsing into functions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>get_model_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">eng_vars=</span>eng_vars, <span class="at">curr_predictors=</span>predictors) {</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  model_data <span class="ot">&lt;-</span> eng_vars <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(object, <span class="fu">all_of</span>(curr_predictors)) <span class="sc">%&gt;%</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>fit_predictor <span class="ot">&lt;-</span> <span class="cf">function</span>(pred, d) {</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="sc">!</span><span class="st">"object"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(d)) <span class="fu">stop</span>(<span class="st">"Missing 'object' column in data"</span>)</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>  xs <span class="ot">&lt;-</span>xs <span class="ot">&lt;-</span> curr_predictors[curr_predictors <span class="sc">!=</span> pred]</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(xs) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="fu">glue</span>(<span class="st">"No valid predictors for {pred}"</span>))</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">length</span>(xs))</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>  x_str <span class="ot">&lt;-</span> xs <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>  formula_str <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{pred} ~ {x_str}"</span>)</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"Fitting model: {formula_str}"</span>))  <span class="co"># Debugging</span></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"{pred} ~ {x_str}"</span>)), <span class="at">data =</span> d) <span class="sc">%&gt;%</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata =</span> d) <span class="sc">%&gt;%</span></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(object, .fitted)</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>max_steps <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>iterate_predictors <span class="ot">&lt;-</span> <span class="cf">function</span>(lang_data) {</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>  missing <span class="ot">&lt;-</span> lang_data <span class="sc">%&gt;%</span></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to=</span><span class="st">"predictor"</span>, <span class="at">values_to=</span><span class="st">"value"</span>, <span class="fu">all_of</span>(curr_predictors)) <span class="sc">%&gt;%</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">missing =</span> <span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>value) <span class="sc">%&gt;%</span></span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>predictor, <span class="at">values_from=</span>missing)</span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>  predictor_order <span class="ot">&lt;-</span> lang_data <span class="sc">%&gt;%</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(predictor, value, <span class="fu">all_of</span>(curr_predictors)) <span class="sc">%&gt;%</span></span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(predictor) <span class="sc">%&gt;%</span></span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">num_na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(value))) <span class="sc">%&gt;%</span></span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(num_na <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(num_na) <span class="sc">%&gt;%</span></span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(predictor)</span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>  imputation_data <span class="ot">&lt;-</span> lang_data <span class="sc">%&gt;%</span></span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(curr_predictors), <span class="sc">~</span> <span class="fu">as.numeric</span>(Hmisc<span class="sc">::</span><span class="fu">impute</span>(., <span class="at">fun =</span> <span class="st">"random"</span>))))</span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_steps) {</span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> predictor_order[(i <span class="sc">%%</span> <span class="fu">length</span>(predictor_order)) <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a>    imputation_fits <span class="ot">&lt;-</span> <span class="fu">fit_predictor</span>(pred, imputation_data)</span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a>    imputation_data <span class="ot">&lt;-</span> missing <span class="sc">%&gt;%</span></span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(object, <span class="sc">!!</span>pred) <span class="sc">%&gt;%</span></span>
<span id="cb123-41"><a href="#cb123-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">missing =</span> <span class="sc">!!</span>pred) <span class="sc">%&gt;%</span></span>
<span id="cb123-42"><a href="#cb123-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">right_join</span>(imputation_data) <span class="sc">%&gt;%</span></span>
<span id="cb123-43"><a href="#cb123-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(imputation_fits) <span class="sc">%&gt;%</span></span>
<span id="cb123-44"><a href="#cb123-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(pred, <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.), .fitted, .))) <span class="sc">%&gt;%</span></span>
<span id="cb123-45"><a href="#cb123-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>.fitted, <span class="sc">-</span>missing)</span>
<span id="cb123-46"><a href="#cb123-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb123-47"><a href="#cb123-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(imputation_data)</span>
<span id="cb123-48"><a href="#cb123-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb123-49"><a href="#cb123-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-50"><a href="#cb123-50" aria-hidden="true" tabindex="-1"></a>model_data_imputed <span class="ot">&lt;-</span> <span class="fu">iterate_predictors</span>(model_data)</span>
<span id="cb123-51"><a href="#cb123-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-52"><a href="#cb123-52" aria-hidden="true" tabindex="-1"></a>uni_model_data <span class="ot">&lt;-</span> model_data_imputed <span class="sc">%&gt;%</span></span>
<span id="cb123-53"><a href="#cb123-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(curr_predictors), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(.)))) <span class="sc">%&gt;%</span>  </span>
<span id="cb123-54"><a href="#cb123-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(</span>
<span id="cb123-55"><a href="#cb123-55" aria-hidden="true" tabindex="-1"></a>    eng_vars <span class="sc">%&gt;%</span> </span>
<span id="cb123-56"><a href="#cb123-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"measure"</span>, <span class="st">"object"</span>, <span class="st">"age"</span>, <span class="st">"num_true"</span>, <span class="st">"num_false"</span></span>
<span id="cb123-57"><a href="#cb123-57" aria-hidden="true" tabindex="-1"></a>                      )))</span>
<span id="cb123-58"><a href="#cb123-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb123-59"><a href="#cb123-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(measure) <span class="sc">%&gt;%</span></span>
<span id="cb123-60"><a href="#cb123-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb123-61"><a href="#cb123-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">unscaled_age =</span> age, <span class="at">age =</span> <span class="fu">scale</span>(age),</span>
<span id="cb123-62"><a href="#cb123-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">as.double</span>(num_true <span class="sc">+</span> num_false), </span>
<span id="cb123-63"><a href="#cb123-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> num_true <span class="sc">/</span> total</span>
<span id="cb123-64"><a href="#cb123-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb123-65"><a href="#cb123-65" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(uni_model_data)</span>
<span id="cb123-66"><a href="#cb123-66" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>get_measure_coefs <span class="ot">&lt;-</span> <span class="cf">function</span>(formula,<span class="at">model_data=</span>uni_model_data, <span class="at">curr_predictors=</span>predictors) {</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>   by_measure_data <span class="ot">&lt;-</span> model_data <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">paste</span>(measure)) <span class="sc">%&gt;%</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(measure, group, object, prop,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>         total, age, <span class="sc">!!</span>curr_predictors) <span class="sc">%&gt;%</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(measure) <span class="sc">%&gt;%</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>measure_models <span class="ot">&lt;-</span> by_measure_data <span class="sc">%&gt;%</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> data <span class="sc">%&gt;%</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">map</span>(<span class="sc">~</span><span class="fu">fit_group_model</span>(.x, formula)))</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  measure_fits <span class="ot">&lt;-</span> measure_models <span class="sc">%&gt;%</span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">results =</span> <span class="fu">map</span>(model, tidy))</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>measure_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"understands"</span>, <span class="st">"produces"</span>)</span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>measure_coefs <span class="ot">&lt;-</span> measure_fits <span class="sc">%&gt;%</span></span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(measure, results) <span class="sc">%&gt;%</span></span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">std_error =</span> std.error,</span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a>         <span class="co">#z_value = z.value,</span></span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_value =</span> p.value) <span class="sc">%&gt;%</span></span>
<span id="cb124-23"><a href="#cb124-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"effect"</span>), <span class="at">sep =</span> <span class="st">" &amp; "</span>, <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb124-24"><a href="#cb124-24" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(</span>
<span id="cb124-25"><a href="#cb124-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">effect =</span> <span class="fu">if_else</span>(<span class="fu">grepl</span>(<span class="st">":"</span>, term), <span class="st">"interaction with age"</span>, effect),</span>
<span id="cb124-26"><a href="#cb124-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(effect), <span class="st">"main effect"</span>, effect),</span>
<span id="cb124-27"><a href="#cb124-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> <span class="fu">if_else</span>(<span class="fu">grepl</span>(<span class="st">":"</span>, term),</span>
<span id="cb124-28"><a href="#cb124-28" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sub</span>(<span class="st">".*:"</span>, <span class="st">""</span>, term), term),</span>
<span id="cb124-29"><a href="#cb124-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect =</span> <span class="fu">fct_relevel</span>(effect, <span class="st">"main effect"</span>, <span class="st">"interaction with age"</span>),</span>
<span id="cb124-30"><a href="#cb124-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">measure =</span> <span class="fu">factor</span>(measure, <span class="at">levels =</span> measure_levels),</span>
<span id="cb124-31"><a href="#cb124-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">signif =</span> p_value <span class="sc">&lt;</span> .alpha) <span class="sc">%&gt;%</span></span>
<span id="cb124-32"><a href="#cb124-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(measure, term, effect) <span class="sc">%&gt;%</span></span>
<span id="cb124-33"><a href="#cb124-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">:added in this line?</span></span>
<span id="cb124-34"><a href="#cb124-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(std_error)) <span class="sc">%&gt;%</span></span>
<span id="cb124-35"><a href="#cb124-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb124-36"><a href="#cb124-36" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(measure_coefs)</span>
<span id="cb124-37"><a href="#cb124-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb124-38"><a href="#cb124-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-39"><a href="#cb124-39" aria-hidden="true" tabindex="-1"></a>plot_effects_data <span class="ot">&lt;-</span> <span class="cf">function</span>(measure_coefs, <span class="at">plot_title=</span><span class="st">"Word developmental trajectory predictors"</span>, <span class="at">curr_predictors=</span>predictors) {</span>
<span id="cb124-40"><a href="#cb124-40" aria-hidden="true" tabindex="-1"></a>predictor_effects <span class="ot">&lt;-</span> measure_coefs <span class="sc">%&gt;%</span></span>
<span id="cb124-41"><a href="#cb124-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"main effect"</span>, term <span class="sc">%in%</span> curr_predictors) <span class="sc">%&gt;%</span></span>
<span id="cb124-42"><a href="#cb124-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">predictor_effect =</span> data) <span class="sc">%&gt;%</span></span>
<span id="cb124-43"><a href="#cb124-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>effect)</span>
<span id="cb124-44"><a href="#cb124-44" aria-hidden="true" tabindex="-1"></a>mean_term_coefs <span class="ot">&lt;-</span> measure_coefs <span class="sc">%&gt;%</span></span>
<span id="cb124-45"><a href="#cb124-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(data)) <span class="sc">%&gt;%</span></span>
<span id="cb124-46"><a href="#cb124-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">"main effect"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb124-47"><a href="#cb124-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb124-48"><a href="#cb124-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_estimate =</span> <span class="fu">mean</span>(estimate),</span>
<span id="cb124-49"><a href="#cb124-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_sig =</span> <span class="fu">sum</span>(signif<span class="sc">==</span><span class="cn">TRUE</span>),</span>
<span id="cb124-50"><a href="#cb124-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_pos =</span> <span class="fu">sum</span>(estimate <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb124-51"><a href="#cb124-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_neg =</span> <span class="fu">sum</span>(estimate <span class="sc">&lt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb124-52"><a href="#cb124-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(mean_estimate)))</span>
<span id="cb124-53"><a href="#cb124-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-54"><a href="#cb124-54" aria-hidden="true" tabindex="-1"></a>coef_order <span class="ot">&lt;-</span> mean_term_coefs <span class="sc">%&gt;%</span> <span class="fu">pull</span>(term)</span>
<span id="cb124-55"><a href="#cb124-55" aria-hidden="true" tabindex="-1"></a>effects_colors <span class="ot">&lt;-</span> viridisLite<span class="sc">::</span><span class="fu">viridis</span>(<span class="fu">length</span>(coef_order), <span class="at">option =</span> <span class="st">"D"</span>)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb124-56"><a href="#cb124-56" aria-hidden="true" tabindex="-1"></a>plt_fixed_coefs <span class="ot">&lt;-</span> measure_coefs <span class="sc">%&gt;%</span></span>
<span id="cb124-57"><a href="#cb124-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb124-58"><a href="#cb124-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> term <span class="sc">%&gt;%</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">rev</span>(coef_order)) <span class="sc">%&gt;%</span></span>
<span id="cb124-59"><a href="#cb124-59" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_relabel</span>(display_predictors),</span>
<span id="cb124-60"><a href="#cb124-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">signif =</span> <span class="fu">ifelse</span>(signif, <span class="st">"significant"</span>, <span class="st">"non-significant"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb124-61"><a href="#cb124-61" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_rev</span>(),</span>
<span id="cb124-62"><a href="#cb124-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">measure =</span> <span class="fu">fct_recode</span>(measure, <span class="st">"comprehension"</span> <span class="ot">=</span> <span class="st">"understands"</span>,</span>
<span id="cb124-63"><a href="#cb124-63" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"production"</span> <span class="ot">=</span> <span class="st">"produces"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb124-64"><a href="#cb124-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(term <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"(intercept)"</span>)))</span>
<span id="cb124-65"><a href="#cb124-65" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plt_fixed_coefs, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> term)) <span class="sc">+</span></span>
<span id="cb124-66"><a href="#cb124-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(measure <span class="sc">~</span> effect, <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb124-67"><a href="#cb124-67" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(label_caps)) <span class="sc">+</span></span>
<span id="cb124-68"><a href="#cb124-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">colour =</span> term, <span class="at">shape =</span> signif,</span>
<span id="cb124-69"><a href="#cb124-69" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmin =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std_error,</span>
<span id="cb124-70"><a href="#cb124-70" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmax =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std_error)) <span class="sc">+</span></span>
<span id="cb124-71"><a href="#cb124-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb124-72"><a href="#cb124-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> effects_colors, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb124-73"><a href="#cb124-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb124-74"><a href="#cb124-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">"Coefficient estimate"</span>, <span class="at">title=</span>plot_title)</span>
<span id="cb124-75"><a href="#cb124-75" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="e.-finally-testing-out-different-models" class="level2">
<h2 class="anchored" data-anchor-id="e.-finally-testing-out-different-models">4e. Finally testing out different models</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for produces...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for understands...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(results)`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `effect`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(data)`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Just removing visual frequency and seeing what the effects look like for our set of items</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>non_viz_predictors <span class="ot">&lt;-</span> predictors[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"visual"</span>, predictors)]</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>non_viz_effects_formula <span class="ot">&lt;-</span> <span class="fu">create_formula</span>(<span class="at">predictors_list =</span> non_viz_predictors)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>non_viz_model_measure_coefs <span class="ot">&lt;-</span> <span class="fu">get_measure_coefs</span>(non_viz_effects_formula) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for produces...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for understands...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(results)`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_data</span>(non_viz_model_measure_coefs, <span class="at">plot_title=</span><span class="st">"Non visual frequency effects"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `effect`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(data)`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The predictors we probably want for the CCN paper</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>smaller_set_of_predictors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"visual_frequency"</span>, <span class="st">"frequency"</span>, <span class="st">"concreteness"</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>input_model_data <span class="ot">&lt;-</span> eng_vars</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>smaller_effects_formula <span class="ot">&lt;-</span> <span class="fu">create_formula</span>(<span class="at">predictors_list =</span> smaller_set_of_predictors)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>smaller_model_data <span class="ot">&lt;-</span> <span class="fu">get_model_data</span>(<span class="at">eng_vars=</span>input_model_data, <span class="at">curr_predictors=</span>smaller_set_of_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attributes are not identical across measure variables; they will be
dropped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>smaller_model_measure_coefs <span class="ot">&lt;-</span> <span class="fu">get_measure_coefs</span>(smaller_effects_formula, <span class="at">model_data=</span>smaller_model_data, <span class="at">curr_predictors=</span>smaller_set_of_predictors) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for produces...
Fitting model for understands...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(results)`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_data</span>(smaller_model_measure_coefs, <span class="at">plot_title=</span><span class="st">"Word developmental trajectory predictors"</span>, <span class="at">curr_predictors=</span>smaller_set_of_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `effect`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(data)`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Trying to get rid of low object detections to see if that makes a difference</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>filtered_model_data <span class="ot">&lt;-</span> eng_vars <span class="sc">|&gt;</span> <span class="fu">filter</span>(log_proportion<span class="sc">&gt;-</span><span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">visual_frequency=</span><span class="fu">scale</span>(log_proportion))</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>smaller_model_data <span class="ot">&lt;-</span> <span class="fu">get_model_data</span>(<span class="at">eng_vars=</span>filtered_model_data, <span class="at">curr_predictors=</span>smaller_set_of_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attributes are not identical across measure variables; they will be
dropped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: concreteness ~ visual_frequency + frequency</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2
Fitting model: frequency ~ visual_frequency + concreteness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>smaller_model_measure_coefs <span class="ot">&lt;-</span> <span class="fu">get_measure_coefs</span>(smaller_effects_formula, <span class="at">model_data=</span>smaller_model_data, <span class="at">curr_predictors=</span>smaller_set_of_predictors) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for produces...
Fitting model for understands...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(results)`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_data</span>(smaller_model_measure_coefs, <span class="at">plot_title=</span><span class="st">"Word developmental trajectory predictors"</span>, <span class="at">curr_predictors=</span>smaller_set_of_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `effect`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(data)`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Seeing how closely I can replicate the original Wordbank plot with the caveat that I’m not using lexical category as an additional predictor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>original_predictors <span class="ot">=</span> predictors[<span class="sc">!</span>(predictors <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"visual_frequency"</span>))]</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>original_model_data <span class="ot">&lt;-</span> <span class="fu">get_model_data</span>(<span class="at">eng_vars=</span>eng_joined <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="st">"object"</span><span class="ot">=</span><span class="st">"uni_lemma"</span>), <span class="at">curr_predictors=</span>original_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attributes are not identical across measure variables; they will be
dropped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: final_frequency ~ frequency + MLU + solo_frequency + num_phons + concreteness + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: frequency ~ MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: solo_frequency ~ frequency + MLU + final_frequency + num_phons + concreteness + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: MLU ~ frequency + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: concreteness ~ frequency + MLU + final_frequency + solo_frequency + num_phons + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: babiness ~ frequency + MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: arousal ~ frequency + MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: valence ~ frequency + MLU + final_frequency + solo_frequency + num_phons + concreteness + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: final_frequency ~ frequency + MLU + solo_frequency + num_phons + concreteness + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: frequency ~ MLU + final_frequency + solo_frequency + num_phons + concreteness + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8
Fitting model: solo_frequency ~ frequency + MLU + final_frequency + num_phons + concreteness + valence + arousal + babiness</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(object)`
Joining with `by = join_by(object)`
Joining with `by = join_by(object)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>original_model_measure_coefs <span class="ot">&lt;-</span> <span class="fu">get_measure_coefs</span>(non_viz_effects_formula, <span class="at">model_data=</span>original_model_data, <span class="at">curr_predictors=</span>original_predictors) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for produces...
Fitting model for understands...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(results)`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_effects_data</span>(original_model_measure_coefs, <span class="at">plot_title=</span><span class="st">"Original model data"</span>, <span class="at">curr_predictors=</span>original_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `effect`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(data)`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="correlation-with-other-predictors" class="level1">
<h1>5. Correlation with other predictors</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(model_data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>object, <span class="sc">-</span>num_phons, <span class="sc">-</span>valence, <span class="sc">-</span>arousal), <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert correlation matrix to long format</span></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>cor_melted <span class="ot">&lt;-</span> reshape<span class="sc">::</span><span class="fu">melt</span>(cor_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in type.convert.default(X[[i]], ...): 'as.is' should be specified by
the caller; using TRUE
Warning in type.convert.default(X[[i]], ...): 'as.is' should be specified by
the caller; using TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse order of labels</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>cor_melted<span class="sc">$</span>X1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(cor_melted<span class="sc">$</span>X1, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">unique</span>(cor_melted<span class="sc">$</span>X1)))</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>cor_melted<span class="sc">$</span>X2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(cor_melted<span class="sc">$</span>X2, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">unique</span>(cor_melted<span class="sc">$</span>X2)))</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define color mapping for axis labels</span></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>axis_label_colors <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"visual"</span>, <span class="fu">levels</span>(cor_melted<span class="sc">$</span>X1)), <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap with updated label ordering and coloring</span></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_melted, <span class="fu">aes</span>(X1, X2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"mako"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="dv">2</span>)), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Label each square</span></span>
<span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Heatmap of Predictor Correlations"</span>,</span>
<span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Correlation"</span>) <span class="sc">+</span></span>
<span id="cb229-16"><a href="#cb229-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">color =</span> axis_label_colors),</span>
<span id="cb229-17"><a href="#cb229-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> axis_label_colors))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Vectorized input to `element_text()` is not officially supported.
ℹ Results may be unexpected or may change in future versions of ggplot2.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Vectorized input to `element_text()` is not officially supported.
ℹ Results may be unexpected or may change in future versions of ggplot2.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="coef_estimates_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>